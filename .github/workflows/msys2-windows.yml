name: CMake msys2 Windows 10

on:
  push:
  pull_request:
  schedule:
    - cron: '0 0 * * 3'
  workflow_dispatch:

jobs:
    build:
      runs-on: windows-latest
      strategy:
        fail-fast: false
        matrix:
          include:
          - { icon: 'ðŸŸ¦', sys: mingw64 }
      name: ðŸš§${{ matrix.icon }} ${{ matrix.sys }}
      defaults:
        run:
          shell: msys2 {0}
      steps:
      - name: 'ðŸ§° Checkout'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: '${{ matrix.icon }} Setup MSYS2'
        uses: msys2/setup-msys2@v2
        with:
          msystem: ${{matrix.sys}}
          update: true
          install: >-
            git
            python
            base-devel
            libxslt-devel
          pacboy: >-
            toolchain:p
            cmake:p
            make:p
            ninja:p
            gcc:p
            minizip:p
      # ----------------------------------------------------------
      - name: Download FPC 32-Bit / 64-Bit for Windows
        run: |
          curl -L -o fpc.tar.gz https://kallup.net/gitpack/fpc.tar.gz
          pwd
          tar -xvzf fpc.tar.gz -C $(pwd)/fpc
          ls -a $(pwd)/fpc/3.2.2/
      # ----------------------------------------------------------
      - name: Add FPC to PATH
        shell: cmd
        run: |
          setx PATH "%PATH%;C:\fpc\3.2.2\bin\i386-win32"
      # ----------------------------------------------------------
      - name: Verify FPC Installation
        shell: cmd
        run: |
          ppcrossx64 -iW
      # ----------------------------------------------------------
      - name: 'ðŸš§ Build TinyRTL for FPC'
        run: |
          echo "hallo"
