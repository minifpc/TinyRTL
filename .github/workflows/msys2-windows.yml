name: CMake msys2 Windows 10

on:
  push:
  pull_request:
  schedule:
    - cron: '0 0 * * 3'
  workflow_dispatch:

jobs:
    build:
      runs-on: windows-latest
      strategy:
        fail-fast: false
        matrix:
          include:
          - { icon: 'ðŸŸ¦', sys: mingw64 }
      name: ðŸš§${{ matrix.icon }} ${{ matrix.sys }}
      defaults:
        run:
          shell: msys2 {0}
      steps:
      - name: 'ðŸ§° Checkout'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: '${{ matrix.icon }} Setup MSYS2'
        uses: msys2/setup-msys2@v2
        with:
          msystem: ${{matrix.sys}}
          update: true
          install: >-
            git
            python
            base-devel
            libxslt-devel
          pacboy: >-
            toolchain:p
            cmake:p
            make:p
            ninja:p
            gcc:p
            minizip:p
      # ----------------------------------------------------------
      - name: Download FPC 32-Bit / 64-Bit for Windows
        run: |
          echo       $(pwd)
          mkdir -p   $(pwd)/fpc
          curl -L -o $(pwd)/fpc/fpc.tar.gz https://kallup.net/gitpack/fpc.tar.gz
          gzip    -d $(pwd)/fpc/fpc.tar.gz
          ls -a      $(pwd)/fpc/
          tar -xf    $(pwd)/fpc/fpc.tar -C $(pwd)/fpc
          export PATH=$PATH:$(pwd)/fpc/3.2.2/bin/i386-win32
          echo "$PATH"
      # ----------------------------------------------------------
      - name: Verify FPC Installation
        shell: cmd
        run: |
          echo test1
          setx PATH "%PATH%;d:\a\TinyRTL\TinyRTL\fpc\3.2.2\bin\i386-win32"
          echo test2
          echo %PATH%
          echo test3
          ppcrossx64.exe -iW
          echo tsst4
      # ----------------------------------------------------------
      - name: 'ðŸš§ Build TinyRTL for FPC'
        run: |
          echo "hallo"
